<div class="topbar show-nav-bar">
  <div class="user-icon">
    <%= link_to :back do %>
      <i class="fa-solid fa-arrow-left dark-topbar-icon"></i>
    <% end %>
  </div>
  <div class="user-icon">
    <%= link_to(edit_user_registration_path) do %>
      <i class="fa-solid fa-user grey-topbar-icon"></i>
    <% end %>
  </div>
</div>
<div class="align-items-center no-padding show-page">
  <img class="show-recipe-image" src="<%= @recipe.image %>" alt="<%= @recipe.name %> image">
  <div class="recipe-description">
    <div class="d-flex justify-content-between">
      <div style="width: 230px;">
        <h1><%= @recipe.name %></h1>
      </div>
      <div class="recipe-show-servings">
        <p><%= @recipe.servings %> servings</p>
      </div>
    </div>
    <br>
    <h3 class="show-page-h3">Recipe Ingredients</h3>
    <div class="show-page-content">
      <% @recipe.recipe_ingredients.each do |recipe_ingredient| %>
        <% if current_user.pantry.ingredients.include?(recipe_ingredient.ingredient) && current_user.pantry_ingredients.find_by(ingredient: recipe_ingredient.ingredient).in_stock %>
          <p class="show-page-p"><%= recipe_ingredient.amount %> <%= recipe_ingredient.unit %>   <%= recipe_ingredient.ingredient.name %> ✔️</p>
        <% else %>
          <p class="show-page-p"><%= recipe_ingredient.amount %> <%= recipe_ingredient.unit %>   <%= recipe_ingredient.ingredient.name %> ❌</p>
        <% end %>
      <% end %>
    </div>
    <h3 class="show-page-h3">Recipe Instructions</h3>
    <p class="show-page-p mb-4"><%= @recipe.instructions.html_safe %></p>
    <br>
    <br>
    <br>
    <br>
    <br>
    <div data-controller="sweetalert">
      <% if current_user.favorited?(@recipe) %>
        <%= link_to 'Remove from Cookbook', unfavorite_recipe_pantry_path(@recipe), method: :post, class: "primary-dark-btn-wfd", id: "sweet-alert-unfavorite",  style: "margin-bottom: 60px;" %>
      <% else %>
        <%= link_to 'Add to Cookbook', favorite_recipe_pantry_path(@recipe), method: :post, class: "primary-dark-btn-wfd", id: "sweet-alert-favorite", style: "margin-bottom: 60px;" %>
      <% end %>
    </div>
    <button type="button" class="secondary-light-btn-wfd" data-bs-toggle="modal" data-bs-target="#exampleModal">
      Finished Cooking!
    </button>

    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-controller="shop-ingredients" data-shop-ingredients-url-value="<%= pantry_pantry_ingredient_url %>">

      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="exampleModalLabel">Mark the ingredients to add to your shopping list</h2>
          </div>
          <div class="modal-body">
          <% @recipe.recipe_ingredients.each do |recipe_ingredient| %>
            <% ingredient = Ingredient.find(recipe_ingredient.ingredient_id) %>
            <% if pantry_ingredient = PantryIngredient.find_by(ingredient: ingredient) %>
              <% if pantry_ingredient.in_stock %>
                <div class="form-check form-switch" data-shop-ingredients-target="ingredient" data-shop-ingredients-id-value="<%= pantry_ingredient.id %>">
                  <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
                  <label class="form-check-label" for="flexSwitchCheckDefault"><%= pantry_ingredient.ingredient.name.titleize %></label>
                </div>
              <% else %>
                <div class="form-check form-switch" data-shop-ingredients-target="ingredient" data-shop-ingredients-id-value="<%= pantry_ingredient.id %>">
                  <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked" checked>
                  <label class="form-check-label" for="flexSwitchCheckChecked"><%= pantry_ingredient.ingredient.name.titleize %></label>
                </div>
              <% end %>
            <% else %>
              <% pantry_ingredient = PantryIngredient.create!(pantry: current_user.pantry, ingredient: ingredient, in_stock: false, default: true) %>
              <div class="form-check form-switch" data-shop-ingredients-target="ingredient" data-shop-ingredients-id-value="<%= pantry_ingredient.id %>">
                <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked" checked>
                <label class="form-check-label" for="flexSwitchCheckChecked"><%= pantry_ingredient.ingredient.name.titleize %></label>
              </div>
            <% end %>
          <% end %>
          </div>
          <div class="modal-footer">
            <%= link_to "Save changes", pantry_shopping_list_path(current_user), "data-action": "click->shop-ingredients#update", class: "modal-footer-primary-btn" %>
            <button type="button" class="modal-footer-secondary-btn" style="position: inherit" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <br>
  <br>
  <br>
</div>
