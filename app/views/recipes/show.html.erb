<div class="topbar show-nav-bar">
  <div class="user-icon">
    <%= link_to :back do %>
      <i class="fa-solid fa-arrow-left dark-topbar-icon"></i>
    <% end %>
  </div>
  <div class="user-icon">
    <%= link_to(edit_user_registration_path) do %>
      <i class="fa-solid fa-user grey-topbar-icon"></i>
    <% end %>
  </div>
</div>
<div class="align-items-center no-padding show-page">
  <img class="show-recipe-image" src="<%= @recipe.image %>" alt="<%= @recipe.name %> image">
  <div class=" container recipe-description">
    <h1><%= @recipe.name %></h1>
    <h3 class="show-page-h3">Recipe Ingredients</h3>
    <div class="show-page-content">
      <% @recipe.recipe_ingredients.each do |recipe_ingredient| %>
        <% if current_user.pantry.ingredients.include?(recipe_ingredient.ingredient) && current_user.pantry_ingredients.find_by(ingredient: recipe_ingredient.ingredient).in_stock %>
          <p class="show-page-p"><%= recipe_ingredient.amount %> <%= recipe_ingredient.unit %>   <%= recipe_ingredient.ingredient.name %> ✔️</p>
        <% else %>
          <p class="show-page-p"><%= recipe_ingredient.amount %> <%= recipe_ingredient.unit %>   <%= recipe_ingredient.ingredient.name %> ❌</p>
        <% end %>
      <% end %>
    </div>
      <h3 class="show-page-h3">Recipe Instructions</h3>
      <p class="show-page-p mb-1"><%= @recipe.instructions.html_safe %></p>
      <button type="button" class="primary-dark-btn-wfd" data-bs-toggle="modal" data-bs-target="#exampleModal">
        Finished Cooking!
      </button>
      <%= link_to 'Add to Cookbook', favorite_recipe_pantry_path(@recipe), method: :post, class: "primary-dark-btn-wfd" %>

      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-controller="shop-ingredients">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Mark the ingredients to add to your shopping list</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <% @recipe.recipe_ingredients.each do |recipe_ingredient| %>
              <% if pantry_ingredient = PantryIngredient.find_by(ingredient: recipe_ingredient) %>
                <% if pantry_ingredient.in_stock %>
                  <div class="form-check form-switch" data-shop-ingredients-target="ingredient" data-shop-ingredients-id-value="<%= pantry_ingredient.id %>">
                    <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
                    <label class="form-check-label" for="flexSwitchCheckDefault"><%= pantry_ingredient.ingredient.name.titleize %></label>
                  </div>
                <% else %>
                  <div class="form-check form-switch" data-shop-ingredients-target="ingredient" data-shop-ingredients-id-value="<%= pantry_ingredient.id %>">
                    <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked" checked>
                    <label class="form-check-label" for="flexSwitchCheckChecked"><%= pantry_ingredient.ingredient.name.titleize %></label>
                  </div>
                <% end %>
              <% else %>
                <% pantry_ingredient = PantryIngredient.create!(pantry: current_user.pantry, ingredient: recipe_ingredient.ingredient, in_stock: false, default: false) %>
                <div class="form-check form-switch" data-shop-ingredients-target="ingredient" data-shop-ingredients-id-value="<%= pantry_ingredient.id %>">
                  <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked" checked>
                  <label class="form-check-label" for="flexSwitchCheckChecked"><%= pantry_ingredient.ingredient.name.titleize %></label>
                </div>
              <% end %>
            <% end %>
            </div>
            <div class="modal-footer">
              <button type="button" class="secondary-btn-home-wfd" data-action="click->shop-ingredients#update">Save changes</button>
              <button type="button" class="primary-btn-home-wfd"  style="background-color: white" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
  </div>
  <br>
  <br>
  <br>
</div>
